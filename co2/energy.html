<!DOCTYPE html>
<html>
<head>
  <title>Energy</title>  
  <!-- Code referenced from Mike Bostock -->
  <script src="//d3js.org/d3.v3.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <link rel="stylesheet" type="text/css" href="master.css" />
  <link rel="stylesheet" type="text/css" href="energy.css"/>
	<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
	<script type="text/javascript" src="master.js"></script>
  <!-- Load an icon library to show a hamburger menu (bars) on small screens -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
  <div id="nav-placeholder"></div>
  <script>
    $(function(){
      $("#nav-placeholder").load("navigation.html", function() {
        $("a[href= 'energy.html']").addClass("selected");
      });
    });
  </script>

  <h1>Global Energy Consumption(Mtoe)</h1>
  <p>Hover over the burst to see tooltips and click on the part you're interesting in to see more info</p>
  <h2 id = "yeartxt">Year: 1990</h2>
  
  <input id="yearslider" type="range" min="1990" max="2017" step="1" value = "1990"></input>

  <!-- <form>
  <input type = "radio" value = "consumption" onchange="parseFile(this.value);">Global Energy Consumption</input>
  <input type = "radio" value = "production" onchange="parseFile(this.value);">Energy Production</input>
  <input type = "radio" value = "crudeoil" onchange="parseFile(this.value);">Crude Oil</input>
  <input type = "radio" value = "naturalgas" onchange="parseFile(this.value);">Natural Gas</input>
  <input type = "radio" value = "oilproducts" onchange="parseFile(this.value);">Oil Products</input>
  <input type="submit">
  </form> -->

  <script>
    var width = 960,
        height = 700,
        radius = (Math.min(width, height) / 2) - 10;
    var formatNumber = d3.format(",d");
    var x = d3.scale.linear()
        .range([0, 2 * Math.PI]);
    var y = d3.scale.sqrt()
        .range([0, radius]);
    var color = d3.scale.category20c();
    var partition = d3.layout.partition()
        .value(function(d) { return d.size; });
    var arc = d3.svg.arc()
        .startAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x))); })
        .endAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x + d.dx))); })
        .innerRadius(function(d) { return Math.max(0, y(d.y)); })
        .outerRadius(function(d) { return Math.max(0, y(d.y + d.dy)); });

    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height)
      .append("g")
        .attr("transform", "translate(" + width / 2 + "," + (height / 2) + ")");

    parseFile("consumption");

    function inputData(file){
      d3.json(file, function(error, root) {
        if (error) throw error;
        var year = 0;
        var path = svg.selectAll("path");
        var data = path.data(partition.nodes(root[year]));

        drawSunburst(data,root[year]);
        d3.select("#yearslider").on("input", function(){
          d3.select("#yeartxt").text("Year: " + this.value);
        });

        d3.select("#yearslider").on("change", function(){
          year = this.value - 1990;
          drawSunburst(path,root[year]);
          
        });
      });
      }
    function parseFile(file) {
      switch(file){
        case "consumption":
          d3.select("h1").text("Global Energy Consumption(Mtoe)");
          inputData("./energyusage.json");
          break;
        case "production": 
          d3.select("h1").text("Energy Production");
          inputData("../dataSets/energy/individualCreate/Total energy production.json");
          break;
        case "crudeoil": 
          d3.select("h1").text("Crude Oil Consumption");
          inputData("../dataSets/energy/individualCreate/Crude oil input to refineries.json");
          break;
        case "oilproducts": 
          d3.select("h1").text("Oil Products Consumption");
          inputData("../dataSets/energy/individualCreate/Oil products domestic consumpt.json");
          break;
        case "production": 
          d3.select("h1").text("Natural Gas Production");
          inputData("../dataSets/energy/individualCreate/Natural gas production.json");
          break;
        default:
          d3.select("h1").text("Global Energy Consumption(Mtoe)");
          inputData("./energyusage.json");
          break;
      }
    }
    function drawSunburst(path, root){
      path
          .data(partition.nodes(root))
        .enter().append("path")
          .attr("d", arc)
          .style("fill", function(d) { return color(d.name); })
          .on("click", click)
        .append("title")
          .text(function(d) { return d.name + "\n" + formatNumber(d.size); })

    }
    function click(d) {
      svg.transition()
          .duration(750)
          .tween("scale", function() {
            var xd = d3.interpolate(x.domain(), [d.x, d.x + d.dx]),
                yd = d3.interpolate(y.domain(), [d.y, 1]),
                yr = d3.interpolate(y.range(), [d.y ? 20 : 0, radius]);
            return function(t) { x.domain(xd(t)); y.domain(yd(t)).range(yr(t)); };
          })
        .selectAll("path")
          .attrTween("d", function(d) { return function() { return arc(d); }; });
    }
    d3.select(self.frameElement).style("height", height + "px");
  </script>
  <p>It is important to know how the use of energy can impact climate change. As we can see in this sunburst, more and more energy is being
    used every year. These energy include coals, natuarl gas, and oil. However, there are energy and resources that a non-renewable. Meaning
    if we keep producing and consuming resources and energy, the world will eventually run out. We need to know how to minimize our energy usage
    not only for the world, but for the climate as well. Fossil fuels for example generate a lot of CO2 that is a factor to global warming. This 
    visualization tells us story of how if we keep using energy like this. Climate change will accelerate.
  </p>
  <p>Source:<a href="https://yearbook.enerdata.net/" target="_blank">https://yearbook.enerdata.net/</a></p><br/>
</body>
</html>
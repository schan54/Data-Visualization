<!DOCTYPE html>
<meta charset="utf-8">
<style>

svg {
  font: 10px sans-serif;
}

.y.axis path {
  display: none;
}

.y.axis line {
  stroke: rgb(26, 22, 22);
  stroke-opacity: .2;
  shape-rendering: crispEdges;
}

.y.axis .zero line {
  stroke: #000;
  stroke-opacity: 1;
}

.title {
  font: 300 78px Helvetica Neue;
  fill: #666;
}

.birthyear,
.month {
  text-anchor: middle;
}





rect:first-child {
  fill: #1f77b4;
}

div.tooltip {	
    position: absolute;			
    text-align: center;			
    width: 60px;					
    height: 28px;					
    padding: 2px;				
    font: 12px sans-serif;		
    background: lightsteelblue;	
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;			
}
</style>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<input class="selector" type="button" value="Customers" id="test.tsv"/>
<input class="selector" type="button" value="Employees" id="population.tsv"/>
<script>

var margin = {top: 20, right: 40, bottom: 30, left: 20},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom,
    barWidth = Math.floor(width / 19) - 1;

var x = d3.scale.linear()
    .range([barWidth / 2, width - barWidth / 2]);

var y = d3.scale.linear()
    .range([height, 0]);

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("right")
    .tickSize(-width)
    .tickFormat(function(d) { return Math.round(d / 1) ; });
 var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);
// An SVG element with a bottom-right origin.
var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// A sliding container to hold the bars by birthyear.
var birthyears = svg.append("g")
    .attr("class", "birthyears");

// A label for the current year.
var title = svg.append("text")
    .attr("class", "title")
    .attr("dy", ".71em")
    .text(2000);

d3.tsv("test.tsv", function(error, data) {

  // Convert strings to numbers.
  data.forEach(function(d) {
    d.tem = +d.tem;

    d.year = +d.year;
    d.month = +d.month;
  });

  // Compute the extent of the data set in age and years.
  var month1 = d3.max(data, function(d) { return d.month; }),
      year0 = d3.min(data, function(d) { return d.year; }),
      year1 = d3.max(data, function(d) { return d.year; }),
      year = year1;

  // Update the scale domains.
  x.domain([year1 - month1, year1]);
  y.domain([d3.min(data, function(d) { return d.tem; }), d3.max(data, function(d) { return d.tem; })]);

  
  // Produce a map from year and birthyear to [male, female].
  data = d3.nest()
      .key(function(d) { return d.year; })
      .key(function(d) { return d.year - d.month; })
      .rollup(function(v) { return v.map(function(d) { return d.tem; }); })
      .map(data);

  // Add an axis to show the population values.
  svg.append("g")
      .attr("class", "y axis")
      .attr("transform", "translate(" + width + ",0)")
      .call(yAxis)
    .selectAll("g")
    .filter(function(value) { return !value; })
      .classed("zero", true);

  // Add labeled rects for each birthyear (so that no enter or exit is required).
  var birthyear = birthyears.selectAll(".birthyear")
      .data(d3.range(year0 - month1, year1 + 1, 1))
    .enter().append("g")
      .attr("class", "birthyear")
      .attr("transform", function(birthyear) { return "translate(" + x(birthyear) + ",0)"; });

  birthyear.selectAll("rect")
      .data(function(birthyear) { return data[year][birthyear] || [0, 0]; })
    .enter().append("rect")
      .attr("x", -barWidth / 2)
      .attr("width", barWidth)
      .attr("y", y)
      .attr("height", function(value) { return height - y(value)+10; })       
       .on("mouseover", function(d) {		
            div.transition()		
                .duration(200)		
                .style("opacity", .9);		
                div.html(d)
                .style("left", (d3.event.pageX) + "px")		
                .style("top", (d3.event.pageY) + "px");	
            })					
        .on("mouseout", function(d) {		
            div.transition()		
                .duration(500)		
                .style("opacity", 0);	
        });

    svg.append("text")             
      .attr("transform",
            "translate(" + (width/2) + " ," + 
                           (height + margin.bottom ) + ")")
      .style("text-anchor", "middle")
      .text("Month");

    svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0 - margin.left)
      .attr("x",0 - (height / 2))
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .text("Temperature");  

  // Add labels to show birthyear.
 /* birthyear.append("text")
      .attr("y", height - 4)
      .text(function(birthyear) { return birthyear; });*/

  // Add labels to show age (separate; not animated).
  svg.selectAll(".month")
      .data(d3.range(0, month1 + 1, 1))
    .enter().append("text")
      .attr("class", "month")
      .attr("x", function(month) { return x(year - month); })
      .attr("y", height + 4)
      .attr("dy", ".71em")

      .text(function(month) { return month; });


  // Allow the arrow keys to change the displayed year.
  window.focus();
  d3.select(window).on("keydown", function() {
    switch (d3.event.keyCode) {
      case 37: year = Math.max(year0, year - 1); break;
      case 39: year = Math.min(year1, year + 1); break;
    }
    update();
  });

  function update() {
    if (!(year in data)) return;
    title.text(year);

    birthyears.transition()
        .duration(750)
        .attr("transform", "translate(" + (x(year1) - x(year)) + ",0)");

    birthyear.selectAll("rect")
        .data(function(birthyear) { return data[year][birthyear] || [0, 0]; })
      .transition()
        .duration(750)
        .attr("y", y)
        .attr("height", function(value) { return height - y(value)+10; });
  }
});








d3.selectAll('.selector')
			.on('click', function(d) {
				updateTest(this.id);
			})
		
		// update function:
function updateTest(source) {
		d3.tsv(source, function(error,data) {
			

            var margin = {top: 20, right: 40, bottom: 30, left: 20},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom,
    barWidth = Math.floor(width / 19) - 1;

var x = d3.scale.linear()
    .range([barWidth / 2, width - barWidth / 2]);

var y = d3.scale.linear()
    .range([height, 0]);

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("right")
    .tickSize(-width)
    .tickFormat(function(d) { return Math.round(d / 1) ; });
 var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);


// A sliding container to hold the bars by birthyear.
var birthyears = svg.append("g")
    .attr("class", "birthyears");

// A label for the current year.
var title = svg.append("text")
    .attr("class", "title")
    .attr("dy", ".71em")
    .text(2000);

// Convert strings to numbers.
data.forEach(function(d) {
  d.tem = +d.tem;

  d.year = +d.year;
  d.month = +d.month;
});

// Compute the extent of the data set in age and years.
var month1 = d3.max(data, function(d) { return d.month; }),
    year0 = d3.min(data, function(d) { return d.year; }),
    year1 = d3.max(data, function(d) { return d.year; }),
    year = year1;

// Update the scale domains.
x.domain([year1 - month1, year1]);
y.domain([0, d3.max(data, function(d) { return d.tem; })]);


// Produce a map from year and birthyear to [male, female].
data = d3.nest()
    .key(function(d) { return d.year; })
    .key(function(d) { return d.year - d.month; })
    .rollup(function(v) { return v.map(function(d) { return d.tem; }); })
    .map(data);

// Add an axis to show the population values.
svg.append("g")
    .attr("class", "y axis")
    .attr("transform", "translate(" + width + ",0)")
    .call(yAxis)
  .selectAll("g")
  .filter(function(value) { return !value; })
    .classed("zero", true);

// Add labeled rects for each birthyear (so that no enter or exit is required).
var birthyear = birthyears.selectAll(".birthyear")
    .data(d3.range(year0 - month1, year1 + 1, 1))
  .enter().append("g")
    .attr("class", "birthyear")
    .attr("transform", function(birthyear) { return "translate(" + x(birthyear) + ",0)"; });

birthyear.selectAll("rect")
    .data(function(birthyear) { return data[year][birthyear] || [0, 0]; })
  .enter().append("rect")

    .attr("x", -barWidth / 2)
    .attr("width", barWidth)
    .attr("y", y)
    .attr("height", function(value) { return height - y(value)+10; })       
     .on("mouseover", function(d) {		
          div.transition()		
              .duration(200)		
              .style("opacity", .9);		
              div.html(d)
              .style("left", (d3.event.pageX) + "px")		
              .style("top", (d3.event.pageY) + "px");	
          })					
      .on("mouseout", function(d) {		
          div.transition()		
              .duration(500)		
              .style("opacity", 0);	
      });

  svg.append("text")             
    .attr("transform",
          "translate(" + (width/2) + " ," + 
                         (height + margin.bottom ) + ")")
    .style("text-anchor", "middle")
    .text("Month");

  svg.append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 0 - margin.left)
    .attr("x",0 - (height / 2))
    .attr("dy", "1em")
    .style("text-anchor", "middle")
    .text("Temperature");  

// Add labels to show birthyear.
/* birthyear.append("text")
    .attr("y", height - 4)
    .text(function(birthyear) { return birthyear; });*/

// Add labels to show age (separate; not animated).
svg.selectAll(".month")
    .data(d3.range(0, month1 + 1, 1))
  .enter().append("text")
    .attr("class", "month")
    .attr("x", function(month) { return x(year - month); })
    .attr("y", height + 4)
    .attr("dy", ".71em")

    .text(function(month) { return month; });


// Allow the arrow keys to change the displayed year.
window.focus();
d3.select(window).on("keydown", function() {
  switch (d3.event.keyCode) {
    case 37: year = Math.max(year0, year - 1); break;
    case 39: year = Math.min(year1, year + 1); break;
  }
  update();
});

function update() {
  if (!(year in data)) return;
  title.text(year);

  birthyears.transition()
      .duration(750)
      .attr("transform", "translate(" + (x(year1) - x(year)) + ",0)");

  birthyear.selectAll("rect")
      .data(function(birthyear) { return data[year][birthyear] || [0, 0]; })
    .transition()
      .duration(750)
      .attr("y", y)
      .attr("height", function(value) { return height - y(value) +10; });
      rect.exit().transition().attr('r',0).duration(1000).remove();

}
});

					
		}
</script>